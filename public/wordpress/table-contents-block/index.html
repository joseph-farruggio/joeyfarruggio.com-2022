<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A table of contents Gutenberg block</title>
    <meta name="description" content="">
    
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        
        try {
            if (!('theme' in window.localStorage)) {
                document.documentElement.classList.add('dark')
                document.documentElement.style.backgroundColor = "#040817";
            }
            else if (window.localStorage.theme === 'dark' || (!('theme' in window.localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark')
                document.documentElement.style.backgroundColor = "#040817";
            } else {
                document.documentElement.classList.remove('dark')
                document.documentElement.style.backgroundColor = "#fff";
            }
        } catch (_) {}
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129275479-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-129275479-1');
    </script>

    <link rel="stylesheet" href="/css/styles.min.css">
    <link rel="stylesheet" href="/css/nightowl.min.css">
    
    <!-- test -->
</head>
<body x-data="app()" class="bg-white dark:bg-[#040817] transition-colors dark:text-white text-slate-800 font-body">
    <header class="max-w-screen-xl mx-auto px-4 py-4 md:py-8 text-right" x-data="{menuOpen: false}">
        <div class="hidden fixed md:static top-0 left-0 h-screen w-screen md:h-auto md:w-full z-40 pb-16 md:p-0 bg-white dark:bg-darkBG md:bg-transparent dark:md:bg-transparent md:flex md:items-center md:justify-between" :class="{'block': menuOpen, 'hidden': !menuOpen}">
            <nav class="text-center flex flex-col md:block text-2xl md:text-lg md:space-x-6">
                <a href="/" class="block md:inline dark:text-slate-500  dark:hover:text-white text-slate-900 transition-colors hover:text-orange-400  no-underline  px-4 py-3 rounded-lg">Home</a>
                <a href="/contact" class="block md:inline dark:text-slate-500  dark:hover:text-white text-slate-900 transition-colors hover:text-orange-400  no-underline  px-4 py-3 rounded-lg">Contact</a>
                <a href="/blog" class="block md:inline dark:text-slate-500  dark:hover:text-white text-slate-900 transition-colors hover:text-orange-400  no-underline  px-4 py-3 rounded-lg">Blog</a>
            </nav>
            <button x-on:click="toggleTheme()" class="print:hidden relative flex items-center mx-auto md:mx-0 mt-32 md:mt-0 justify-between border dark:border-slate-800 bg-white dark:bg-slate-900 border-slate-200 px-4 py-2 rounded-full outline-none focus:outline-none shadow-none">
                <div class="h-full aspect-square border-slate-300 bg-white dark:bg-slate-800 rounded-full shadow-lg absolute top-0 left-0 dark:-ml-10 dark:left-full transition-transform"></div>
                <svg xmlns="http://www.w3.org/2000/svg" class="relative h-6 w-6 dark:text-slate-400 text-orange-400 -ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="relative h-6 w-6 dark:text-orange-400 text-slate-300 ml-4 -mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
            </button>
        </div>
        <button class="print:hidden  border-none ml-full inline-block p-4 relative z-50 md:hidden" @click="menuOpen = !menuOpen">
            <svg xmlns="http://www.w3.org/2000/svg" x-show="!menuOpen" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16" /></svg>
            <svg xmlns="http://www.w3.org/2000/svg" x-show="menuOpen" x-cloak class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
    </header>
    
    <main class="">
        <article id="post" class="prose lg:prose-xl max-w-screen-md mx-auto px-4 mt-12" :class="{'prose-invert': dark}">
    <h1 class="dark:text-orange-400 text-4xl text-highlight-orange">A table of contents Gutenberg block</h1>
    <p class=" text-lg mt-4 leading-relaxed">Insert a table of contents anywhere in your post with this Gutenberg block.</p>
    <span class="flex items-center space-x-4 mt-4 text-gray-400">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
        <time datetime="2022-01-03">03 Jan 2022</time>
    </span>
    <div class="mt-16"></div>   
    <p>I end up building a table of contents feature for most WordPress sites that I work on. They include the following features:</p>
<ol>
<li>Insert the TOC as either a block in the sidebar area</li>
<li>Insert the TOC as a block anywhere in the post content</li>
<li>Automatically generate a TOC based on headings in the post</li>
<li>Automatically assign IDs to headings on the frontend</li>
<li>Limit the TOC by heading level</li>
<li>Ignore headings with an <code>.ignore</code> class name on headings</li>
<li>Override the TOC and provide a custom list while maintaining the same markup and styles</li>
</ol>
<h2>Get the blocks from post_content</h2>
<p>Getting the headings from a post in Gutenberg is easy with the <code>parse_blocks()</code> function.</p>
<pre class="language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">has_blocks</span><span class="token punctuation">(</span> <span class="token variable">$post</span><span class="token operator">-></span><span class="token property">post_content</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>   <span class="token comment">// Get the post content</span><br>   <span class="token variable">$blocks</span> <span class="token operator">=</span> <span class="token function">parse_blocks</span><span class="token punctuation">(</span> <span class="token variable">$post</span><span class="token operator">-></span><span class="token property">post_content</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>   <span class="token comment">// continued...</span><br><span class="token punctuation">}</span></code></pre>
<h2>Loop through the blocks</h2>
<p>We can loop through the blocks and target just the heading blocks by <code>blockName</code>.</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><br><span class="token comment">// Loop through each block</span><br><span class="token keyword">foreach</span><span class="token punctuation">(</span> <span class="token variable">$blocks</span> <span class="token keyword">as</span> <span class="token variable">$block</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>    <span class="token comment">// Target just headings by blockName</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'blockName'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'core/heading'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>        <span class="token comment">// continued...</span><br>    <span class="token punctuation">}</span><br>    <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2>Heading Levels via Attributes</h2>
<p>Headings have a <code>level</code> attribute. We can use this to target headings by level. For some reason, H2 headings do not have a 'level' attribute, so I assign one.</p>
<pre class="language-php"><code class="language-php"><br><span class="token comment">// Assign a level attr for H2s</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'attrs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'attrs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2>Display headings if it passes the tests</h2>
<p>Now that we have all of the heading blocks we check if the heading level is in our heading list (an array from an ACF field in the block) and ensure it doesn't have the <code>.ignore</code> class name.</p>
<pre class="language-php"><code class="language-php"><span class="token comment">// Store the heading level for the current block in the loop in a variable</span><br><span class="token variable">$headingLevel</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'h'</span><span class="token operator">.</span><span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'attrs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token comment">// Include the heading if it is in the headings list and is not ignored</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$headingLevel</span><span class="token punctuation">,</span>  <span class="token function">get_field</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'headings'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'attrs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'className'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ignore'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br>    <span class="token comment">// The heading markup is stored in 'innerHTML'</span><br>    <span class="token variable">$fullstring</span> <span class="token operator">=</span> <span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'innerHTML'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// We don't want to display the heading HTML, just the string of text, so we remove the tags</span><br>    <span class="token variable">$parsed</span> <span class="token operator">=</span> <span class="token function">get_string_between</span><span class="token punctuation">(</span><span class="token variable">$fullstring</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'>'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;/h'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">/**<br>    * Echo the TOC item<br>    * toSafeID() takes the heading ID and removes spaces and special characters<br>    */</span><br>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;li>&lt;a href='#"</span> <span class="token operator">.</span> <span class="token function">toSafeID</span><span class="token punctuation">(</span><span class="token variable">$parsed</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"'>"</span> <span class="token operator">.</span> <span class="token variable">$parsed</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;/a>&lt;/li>"</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Interested in seeing all of the code together? Check out the repo here: https://github.com/joseph-farruggio/Slick-Table-of-Contents</p>

</article>

<div class=" max-w-screen-md mx-auto px-4 mt-12">
    <div id="disqus_thread"></div>
</div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://joeyfarruggio-com.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </main>

    <footer class="py-16 bg-slate-900 mt-16"> 

    </footer>
    <script defer src="/js/app.min.js"></script>
</body>
</html>