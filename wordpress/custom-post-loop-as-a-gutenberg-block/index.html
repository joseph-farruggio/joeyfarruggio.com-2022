<blockquote>
<p>This post was updated on October, 5th 2022 to reflect changes in how we register blocks in WordPress 6.0 and Advanced Custom Fields 6.0.</p>
</blockquote>
<h2 id="ignore-toc" class="ignore-toc" x-intersect:enter="$store.showToc = false" x-intersect:leave="$store.showToc = true">Steps in this guide:</h2>
<ol>
<li><a href="#create-fields">Creating our fields</a></li>
<li><a href="#register-block">Register our blocks with block.json</a></li>
<li><a href="#block-data">Handle our block data</a></li>
<li><a href="#render-template">Create the block render template</a></li>
<li><a href="#using-block">Using the block</a></li>
</ol>
<h2 id="create-fields">Creating our fields</h2>
<p>What fields will our block will need to control an output of posts? Sometimes I like to start here because it gets me thinking about how I’m going to use the block. I know this block will interface with the WP_Query class, so a few fields immediately come to mind.</p>
<ol>
<li><strong>Selection Type</strong> <br/>Will we display the most recent posts or do we want to hand pick them?</li>
<li><strong>Category</strong>  <br/>If we’re displaying the most recent posts, do we want to limit them to a specific category?</li>
<li><strong>Limit</strong>  <br/>If we’re displaying the most recent posts, do we want to set a limit for how many are returned?</li>
<li><strong>Select Posts</strong>  <br/>If we choose &quot;select posts&quot;, we'll want a relationship field to hand pick our posts from a list.</li>
</ol>
<p><img src="/images/block-guide-field-group.jpg" alt="&quot;Field Group&quot;" title="Creating the block's field group"></p>
<p>The <code>Category</code> and <code>Limit</code> fields are conditionally displayed if the <code>Selection Type</code> is &quot;recent&quot;. Likewise, the <code>Select Posts</code> field is only displayed if the <code>Selection type</code> is &quot;select posts&quot;.</p>
<p>Want to import this field group into ACF Pro? <a href="https://gist.github.com/joseph-farruggio/72c69968b23c6701932af84690516240" target="_blank">Get the JSON</a> – Once you've imported the JSON into ACF, make sure to update the location rules to match your block name after you register your block.</p>
<h2 id="register-block">Register the block</h2>
<p>Since WP 6.0, the recommended way of registering blocks is <a href="https://developer.wordpress.org/block-editor/reference-guides/block-api/block-metadata/">via block.json</a>. This is a big deal, because keeping our ACF blocks as close to core as possible allows us to take advantage of many native block features.</p>
<p>You can register blocks from a plugin or your theme. For simplicity, and to make this guide more accessible to beginners, I’ll be doing this directly in my theme. Go ahead and stub out the following structure:</p>
<pre class="language-text"><code class="language-text">/theme-root<br>│<br>└─── /blocks<br>│   │   register-blocks.php<br>│   │<br>│   └─── /posts-block<br>│       │   block.json<br>│       │   block.php<br>│       │   template.php</code></pre>
<p>Inside of <code>/blocks/register-blocks.php</code>, we’ll include the path to our block’s json file. This is where we’ll register all of our future blocks:</p>
<pre class="language-php"><code class="language-php"><span class="token function">register_block_type</span><span class="token punctuation">(</span> <span class="token function">get_template_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/blocks/posts-loop/block.json'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>In your <code>functions.php</code> you can include the path to <code>/blocks/register-blocks.php.</code></p>
<pre class="language-php"><code class="language-php"><span class="token comment">/**<br> * Register ACF Blocks<br> */</span><br><span class="token keyword">require</span> <span class="token function">get_template_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/blocks/register-blocks.php'</span><span class="token punctuation">;</span></code></pre>
<h2 id="block-data">Handle our block data</h2>
<p><code>/blocks/posts-block/block.php</code> will serve as the <em>model / controller</em> for our block. It’s where we’ll handle all of the data that gets passed into the render template or the <em>view</em>. This helps keep things clean and organized so our logic is one place (block.php) and our front-end template (template.php) is in another.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br><span class="token comment">/**<br> * Posts Loop Block<br> */</span><br><br><span class="token comment">// $data is what we're going to expose to our render template</span><br><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><br>	<span class="token string single-quoted-string">'selection_type'</span> <span class="token operator">=></span> <span class="token function">get_field</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'selection_type'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><br>	<span class="token string single-quoted-string">'category'</span> <span class="token operator">=></span> <span class="token function">get_field</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'category'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><br>	<span class="token string single-quoted-string">'limit'</span> <span class="token operator">=></span> <span class="token function">get_field</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'limit'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><br>	<span class="token string single-quoted-string">'select_posts'</span> <span class="token operator">=></span> <span class="token function">get_field</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select_posts'</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// WP Query Args</span><br><span class="token variable">$queryArgs</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><br>    <span class="token string single-quoted-string">'post_type'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'post'</span><span class="token punctuation">,</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// If the selection type is "recent", check  for categories and limit</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'selection_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'recent'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token variable">$queryArgs</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category__in'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token variable">$queryArgs</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'posts_per_page'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// If the selection type is "select", pass in the selected post IDs</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'selection_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'select'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token variable">$queryArgs</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post__in'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'select_posts'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Create a new WP_Query instance</span><br><span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WP_Query</span><span class="token punctuation">(</span> <span class="token variable">$queryArgs</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Expose the response of WP_Query to the render template</span><br><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'posts'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$posts</span><span class="token punctuation">;</span><br><br><span class="token comment">/** <br> * Pass the block data into the template part<br> * @param array $block contains attributes and data for the block coming from Gutenberg<br> * @param boolean $is_preview whether the block is in the preview state (the Gutenberg editor) or not (the front-end)<br> * @param integer $post_id the post id of the post that the block is in<br> * @param array $data is what we're going to expose to our render template<br> */</span> <br><br><span class="token function">get_template_part</span><span class="token punctuation">(</span><br>	<span class="token string single-quoted-string">'blocks/posts-loop/template'</span><span class="token punctuation">,</span><br>	<span class="token constant">null</span><span class="token punctuation">,</span><br>	<span class="token keyword">array</span><span class="token punctuation">(</span><br>		<span class="token string single-quoted-string">'block'</span>      <span class="token operator">=></span> <span class="token variable">$block</span><span class="token punctuation">,</span><br>		<span class="token string single-quoted-string">'is_preview'</span> <span class="token operator">=></span> <span class="token variable">$is_preview</span><span class="token punctuation">,</span><br>		<span class="token string single-quoted-string">'post_id'</span>    <span class="token operator">=></span> <span class="token variable">$post_id</span><span class="token punctuation">,</span><br>		<span class="token string single-quoted-string">'data'</span>       <span class="token operator">=></span> <span class="token variable">$data</span><span class="token punctuation">,</span><br>	<span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="render-template">Create the block render template</h2>
<p>Now we can create the block’s render template: <code>/blocks/posts-loop/template.php</code>.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br><span class="token comment">/**<br> * Block Name: Posts Loop Block<br> *<br> * Description: Displays a list of posts.<br> */</span><br><br><span class="token comment">// The block attributes</span><br><span class="token variable">$block</span> <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'block'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token comment">// The block data</span><br><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token comment">// Dynamic block ID</span><br><span class="token variable">$block_id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'posts-loop-block-'</span> <span class="token operator">.</span> <span class="token variable">$block</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token comment">// Check for custom block ID</span><br><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$block</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'anchor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token variable">$block_id</span> <span class="token operator">=</span> <span class="token variable">$block</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'anchor'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Block classes</span><br><span class="token variable">$className</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'posts-loop-block'</span><span class="token punctuation">;</span><br><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$block</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'className'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token variable">$className</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">' '</span> <span class="token operator">.</span> <span class="token variable">$block</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'className'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token delimiter important">?></span></span><br><br><span class="token comment">&lt;!-- Our front-end template to loop the posts --></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$block_id</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$className</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br>    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'posts'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token function">have_posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'posts'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token function">have_posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'posts'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token function">the_post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token delimiter important">?></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">the_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><br>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>                    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">the_excerpt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><br>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>            <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token delimiter important">?></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>Within our render template, our block attributes, such as the block’s ID or classnames, are found in <code>$args['block']</code>. Our block data, fields we specified in <code>blocks/posts-loop/block.php</code>, are found in <code>$args[’data’]</code>.</p>
<p>The response of WP_Query is exposed to this render template in <code>$data['posts']</code>. This is because of the work we did in <code>/blocks/posts-loop/block.php</code>. Here's the line specifically:</p>
<pre class="language-php"><code class="language-php"><span class="token comment">// Create a new WP_Query instance</span><br><span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WP_Query</span><span class="token punctuation">(</span> <span class="token variable">$queryArgs</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Expose the response of WP_Query to the render template</span><br><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'posts'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$posts</span><span class="token punctuation">;</span></code></pre>
<h2 id="using-block">Using the block</h2>
<p><img src="/images/block-guide-editor.jpg" alt="&quot;Block backend UI&quot;" title="Using the block in the editor"></p>
<p>This is what our block looks like when we insert it into the editor. The block's preview is on the left in the content column and our block's fields are in the right sidebar.</p>
<p><img src="/images/block-guide-select-posts.jpg" alt="&quot;Block backend UI - Select Posts&quot;" title="Using the block in the editor to select posts"></p>
<p>If I change the &quot;Selection Type&quot; from <code>Recent</code> to <code>Select posts</code> I'll be able to use the &quot;Select Posts&quot; relationship field.</p>
<hr>
<p>🤜 🤛 You did it!</p>
<p>If you've followed along, let me know how this went or if you have any questions.</p>
<aside 
  x-data="visibleNavHighlighter" 
  x-on:scroll.window.throttle.50ms="onScroll()" 
  x-show.important="$store.showToc"
  x-transition.opacity
  x-cloak>
  <div class="fixed mt-20 right-0 bottom-0 hidden w-64 overflow-y-auto py-8 px-6 md:top-[4rem] xl:block">
    <p class="text-base">In This Guide</p>
    <ul class="space-y-3 list-none m-0 p-0">
        <template x-for="heading in headings">
            <li class="text-base p-0">
                <a :href="'#'+heading.id" class="no-underline" 
                :class="visibleHeadingId == heading.id ? 'font-medium text-orange-400 dark:text-orange-400' : 'text-slate-800 dark:text-white'" x-text="heading.innerText"></a>
            </li>
        </template>
    </ul>
  </div>
</aside>